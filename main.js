/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var x=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var B=Object.prototype.hasOwnProperty;var U=(h,a)=>{for(var t in a)x(h,t,{get:a[t],enumerable:!0})},M=(h,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let s of W(a))!B.call(h,s)&&s!==t&&x(h,s,{get:()=>a[s],enumerable:!(e=$(a,s))||e.enumerable});return h};var F=h=>M(x({},"__esModule",{value:!0}),h);var _={};U(_,{default:()=>I});module.exports=F(_);var d=require("obsidian");var A={defaultCalloutType:"note",rememberLastType:!1,autoFocusContent:!0,lastUsedType:"note",scanSnippets:!0},m=[{type:"note",label:"Note",icon:"lucide-pencil",color:"var(--callout-default)",source:"builtin",aliases:[]},{type:"abstract",label:"Abstract",icon:"lucide-clipboard-list",color:"var(--callout-summary)",source:"builtin",aliases:["summary","tldr"]},{type:"info",label:"Info",icon:"lucide-info",color:"var(--callout-info)",source:"builtin",aliases:[]},{type:"todo",label:"Todo",icon:"lucide-check-circle-2",color:"var(--callout-todo)",source:"builtin",aliases:[]},{type:"important",label:"Important",icon:"lucide-flame",color:"var(--callout-important)",source:"builtin",aliases:[]},{type:"tip",label:"Tip",icon:"lucide-flame",color:"var(--callout-tip)",source:"builtin",aliases:["hint"]},{type:"success",label:"Success",icon:"lucide-check",color:"var(--callout-success)",source:"builtin",aliases:["check","done"]},{type:"question",label:"Question",icon:"lucide-help-circle",color:"var(--callout-question)",source:"builtin",aliases:["help","faq"]},{type:"warning",label:"Warning",icon:"lucide-alert-triangle",color:"var(--callout-warning)",source:"builtin",aliases:["caution","attention"]},{type:"failure",label:"Failure",icon:"lucide-x",color:"var(--callout-fail)",source:"builtin",aliases:["fail","missing"]},{type:"danger",label:"Danger",icon:"lucide-zap",color:"var(--callout-error)",source:"builtin",aliases:["error"]},{type:"bug",label:"Bug",icon:"lucide-bug",color:"var(--callout-bug)",source:"builtin",aliases:[]},{type:"example",label:"Example",icon:"lucide-list",color:"var(--callout-example)",source:"builtin",aliases:[]},{type:"quote",label:"Quote",icon:"lucide-quote",color:"var(--callout-quote)",source:"builtin",aliases:["cite"]}];var f=require("obsidian");var w=class extends f.Modal{constructor(t,e){var n,c;super(t);this.config=e;this.title="";this.content="";this.collapse="none";this.builtinOptions=[];this.snippetOptions=[];this.allCalloutOptions=[];this.type=e.defaultType,this.autoFocusContent=e.autoFocusContent,this.containerEl.addClass("insert-callout-modal"),this.prepareCalloutOptions();let s=this.getEditor();if(s){let p=s.getSelection();p&&(this.content=p)}this.allCalloutOptions.find(p=>p.type===this.type)||(this.type=(c=(n=this.allCalloutOptions[0])==null?void 0:n.type)!=null?c:"note")}getEditor(){var t,e;return(e=(t=this.app.workspace.getActiveViewOfType(f.MarkdownView))==null?void 0:t.editor)!=null?e:null}prepareCalloutOptions(){this.snippetOptions=[...this.config.snippetTypes];for(let t of m)if(this.builtinOptions.push({type:t.type,label:t.label,icon:t.icon,color:t.color,source:"builtin"}),t.aliases)for(let e of t.aliases)this.builtinOptions.push({type:e,label:`${t.label} (${e})`,icon:t.icon,color:t.color,source:"builtin"});this.allCalloutOptions=[...this.snippetOptions,...this.builtinOptions]}onOpen(){this.display()}display(){let{contentEl:t}=this;t.empty(),t.addEventListener("keydown",n=>{n.key==="Enter"&&(n.ctrlKey||n.metaKey)&&(n.preventDefault(),this.insertButton&&this.insertButton.click())});let e=t.createDiv("callout-type-container");this.iconContainerEl=e.createDiv("callout-icon-container"),new f.Setting(e).setName("Callout type").addDropdown(n=>{var g,l;let c=n.selectEl;if(this.snippetOptions.length>0){let i=c.createEl("optgroup",{attr:{label:"Custom"}});for(let o of this.snippetOptions)i.createEl("option",{value:o.type,text:o.label})}let p=c.createEl("optgroup",{attr:{label:"Default"}});for(let i of this.builtinOptions)p.createEl("option",{value:i.type,text:i.label});this.allCalloutOptions.some(i=>i.type===this.type)||(this.type=(l=(g=this.allCalloutOptions[0])==null?void 0:g.type)!=null?l:"note"),n.setValue(this.type),n.onChange(i=>{this.type=i,this.updateIconAndColor(this.iconContainerEl,i)})}),this.updateIconAndColor(this.iconContainerEl,this.type),new f.Setting(t).setName("Title").setDesc("Optional, leave blank for default title").addText(n=>{n.setPlaceholder("Input title").setValue(this.title).onChange(c=>{this.title=c})}),new f.Setting(t).setName("Collapse state").addDropdown(n=>{n.addOption("none","Default").addOption("open","Open").addOption("closed","Closed").setValue(this.collapse).onChange(c=>{this.collapse=c})}),new f.Setting(t).setName("Content").addTextArea(n=>{n.setPlaceholder("Input content").setValue(this.content).onChange(c=>{this.content=c}),n.inputEl.rows=5,n.inputEl.cols=40,this.contentTextArea=n.inputEl}),t.createDiv("insert-callout-shortcut-hint").setText(`${f.Platform.isMacOS?"\u2318":"Ctrl"} + Enter to insert`),new f.Setting(t).addButton(n=>(n.setButtonText("Insert").setCta().onClick(()=>{this.insertCallout(),this.close()}),this.insertButton=n.buttonEl,n)).addButton(n=>(n.setButtonText("Cancel").setTooltip("Cancel").onClick(()=>this.close()),n)),this.autoFocusContent&&setTimeout(()=>{this.contentTextArea&&this.contentTextArea.focus()},10)}updateIconAndColor(t,e){if(!t)return;let s=this.allCalloutOptions.find(n=>n.type===e);t.empty(),s?((0,f.setIcon)(t,s.icon),t.style.setProperty("--callout-color",s.color)):((0,f.setIcon)(t,"lucide-alert-circle"),t.style.removeProperty("--callout-color"))}insertCallout(){let t=this.getEditor();if(!t)return;let e=`> [!${this.type}]`;this.collapse!=="none"&&(e+=this.collapse==="open"?"+":"-"),this.title&&(e+=` ${this.title}`),e+=`
> ${this.content.replace(/\n/g,`
> `)}`;let s=t.getCursor(),n=t.getLine(s.line),c=s.ch===0,p;if(t.getSelection()){!c&&n.trim().length>0&&(e=`
`+e);let g=t.getCursor("from");t.replaceSelection(e);let l=e.split(`
`).length;p={line:g.line+l,ch:0}}else{!c&&n.trim().length>0&&(e=`
`+e),t.replaceRange(e,s);let g=e.split(`
`).length;p={line:s.line+g,ch:0}}setTimeout(()=>{t.replaceRange(`
`,p),t.setCursor({line:p.line+1,ch:0}),t.focus()},0)}};var C=require("obsidian");var T=class extends C.SuggestModal{constructor(t,e,s){super(t);this.allCalloutOptions=[];this.onChoose=s,this.setPlaceholder("Choose a callout type..."),this.prepareCalloutOptions(e)}prepareCalloutOptions(t){for(let e of t)this.allCalloutOptions.push(e);for(let e of m)if(this.allCalloutOptions.push(e),e.aliases)for(let s of e.aliases)this.allCalloutOptions.push({type:s,label:`${e.label} (${s})`,icon:e.icon,color:e.color,source:"builtin"})}getSuggestions(t){let e=t.toLowerCase();return e?this.allCalloutOptions.filter(s=>s.type.toLowerCase().includes(e)||s.label.toLowerCase().includes(e)):this.allCalloutOptions}renderSuggestion(t,e){let s=e.createDiv({cls:"quick-pick-callout-item"}),n=s.createDiv({cls:"quick-pick-callout-icon"});(0,C.setIcon)(n,t.icon),n.style.setProperty("--callout-color",t.color),s.createDiv({cls:"quick-pick-callout-label",text:t.label}),t.source!=="builtin"&&s.createDiv({cls:"quick-pick-callout-source",text:t.source})}onChooseSuggestion(t){this.onChoose(t.type)}static insertQuickCallout(t,e){var l,i;let s=(i=(l=t.workspace.getActiveViewOfType(C.MarkdownView))==null?void 0:l.editor)!=null?i:null;if(!s)return;let n=`> [!${e}]
> `,c=s.getCursor(),p=s.getLine(c.line),g=c.ch===0;if(s.getSelection()){let o=s.getSelection();n=`> [!${e}]
> ${o.replace(/\n/g,`
> `)}`,!g&&p.trim().length>0&&(n=`
`+n);let r=s.getCursor("from");s.replaceSelection(n);let u=n.split(`
`).length,y={line:r.line+u,ch:0};setTimeout(()=>{s.replaceRange(`
`,y),s.setCursor({line:y.line+1,ch:0}),s.focus()},0)}else{!g&&p.trim().length>0&&(n=`
`+n),s.replaceRange(n,c);let o=n.split(`
`).length;setTimeout(()=>{s.setCursor({line:c.line+o-1,ch:2}),s.focus()},0)}}};async function P(h){var l;let a=[],t=[],e=new Set;for(let i of m)if(e.add(i.type),i.aliases)for(let o of i.aliases)e.add(o);let n=h.customCss.enabledSnippets,c=`${h.vault.configDir}/snippets`,p;try{p=await h.vault.adapter.list(c)}catch(i){return{types:a,warnings:t}}let g=p.files.filter(i=>{var u;if(!i.endsWith(".css"))return!1;let r=((u=i.split("/").pop())!=null?u:"").replace(/\.css$/,"");return n.has(r)});for(let i of g){let o;try{o=await h.vault.adapter.read(i)}catch(S){continue}let r=o.match(/\.callout\[data-callout/g),u=r?r.length:0,y=R(o,a,e),b=u-y;if(b>0){let S=(l=i.split("/").pop())!=null?l:i;t.push({file:S,malformedCount:b})}}return{types:a,warnings:t}}function R(h,a,t){let e=/\.callout\[data-callout=["']([^"']+)["']\]\s*\{([^}]*)}/g,s,n=0;for(;(s=e.exec(h))!==null;){n++;let c=s[1],p=s[2];if(!c||!p||t.has(c)||a.some(y=>y.type===c))continue;let g=p.match(/--callout-color:\s*([\d\s,]+)/),l=g&&g[1]?g[1].trim():"var(--callout-default)",i=p.match(/--callout-icon:\s*([\w-]+)/),o=i&&i[1]?i[1]:"lucide-box",r=!(i&&i[1]),u=c.replace(/[-_]/g," ").replace(/\b\w/g,y=>y.toUpperCase());a.push({type:c,label:u,icon:o,color:l,source:"snippet",iconDefault:r})}return n}var I=class extends d.Plugin{constructor(){super(...arguments);this.snippetTypes=[];this.snippetWarnings=[]}async onload(){await this.loadSettings(),this.addCommand({id:"insert-callout",name:"Insert callout",editorCallback:()=>{let t=this.settings.rememberLastType?this.settings.lastUsedType:this.settings.defaultCalloutType,e=new w(this.app,{defaultType:t,autoFocusContent:this.settings.autoFocusContent,snippetTypes:this.snippetTypes}),s=e.close.bind(e);e.close=()=>{this.settings.rememberLastType&&e.type&&(this.settings.lastUsedType=e.type,this.saveSettings()),s()},e.open()}}),this.addCommand({id:"insert-callout-quick",name:"Insert callout (quick pick)",editorCallback:()=>{new T(this.app,this.snippetTypes,e=>{T.insertQuickCallout(this.app,e),this.settings.rememberLastType&&(this.settings.lastUsedType=e,this.saveSettings())}).open()}}),this.addCommand({id:"open-settings",name:"Open settings",callback:()=>{let t=this.app.setting;t.open(),t.openTabById(this.manifest.id)}}),this.addSettingTab(new E(this.app,this)),this.app.workspace.onLayoutReady(()=>{this.refreshSnippetTypes()})}async loadSettings(){this.settings=Object.assign({},A,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async refreshSnippetTypes(){if(this.settings.scanSnippets){let t=await P(this.app);for(let e of t.types)!e.iconDefault&&!(0,d.getIcon)(e.icon)&&(e.iconInvalid=!0);this.snippetTypes=t.types,this.snippetWarnings=t.warnings}else this.snippetTypes=[],this.snippetWarnings=[]}},E=class extends d.PluginSettingTab{constructor(a,t){super(a,t),this.plugin=t}display(){let{containerEl:a}=this;if(a.empty(),new d.Setting(a).setName("Insertion").setHeading(),new d.Setting(a).setName("Default callout type").setDesc("The callout type pre-selected when the modal opens.").addDropdown(t=>{for(let e of m)t.addOption(e.type,e.label);for(let e of this.plugin.snippetTypes)t.addOption(e.type,e.label);t.setValue(this.plugin.settings.defaultCalloutType),t.onChange(async e=>{this.plugin.settings.defaultCalloutType=e,await this.plugin.saveSettings()})}),new d.Setting(a).setName("Remember last used type").setDesc("When enabled, the modal will default to the last callout type you inserted.").addToggle(t=>{t.setValue(this.plugin.settings.rememberLastType),t.onChange(async e=>{this.plugin.settings.rememberLastType=e,await this.plugin.saveSettings()})}),new d.Setting(a).setName("Auto-focus content").setDesc("Automatically focus the content textarea when the modal opens.").addToggle(t=>{t.setValue(this.plugin.settings.autoFocusContent),t.onChange(async e=>{this.plugin.settings.autoFocusContent=e,await this.plugin.saveSettings()})}),new d.Setting(a).setName("Detection").setHeading(),new d.Setting(a).setName("Scan CSS snippets").setDesc("Detect custom callout types defined in your enabled CSS snippet files.").addToggle(t=>{t.setValue(this.plugin.settings.scanSnippets),t.onChange(async e=>{this.plugin.settings.scanSnippets=e,await this.plugin.saveSettings(),await this.plugin.refreshSnippetTypes(),this.display()})}),this.plugin.settings.scanSnippets){let t=this.plugin.snippetTypes.length,e=this.plugin.snippetTypes.filter(l=>l.color.startsWith("var(")).length,s=this.plugin.snippetTypes.filter(l=>l.iconDefault||l.iconInvalid).length,n=this.plugin.snippetTypes.filter(l=>l.color.startsWith("var(")||l.iconDefault||l.iconInvalid).length,c=t>0?`Detected types (${t})`:"No custom types detected",p=t>0?"Custom callout types found in your enabled CSS snippets.":"No callout definitions were found in your enabled CSS snippet files.",g=new d.Setting(a).setName(c).setDesc(p).addExtraButton(l=>{l.setIcon("refresh-cw").setTooltip("Refresh snippets").onClick(async()=>{await this.plugin.refreshSnippetTypes(),this.display()})}).addExtraButton(l=>{l.setIcon("folder-open").setTooltip("Open snippets folder").onClick(()=>{let i=`${this.app.vault.configDir}/snippets`;this.app.openWithDefaultApp(i)})});if(n>0){let l=this.plugin.snippetTypes.filter(u=>u.iconDefault).length,i=this.plugin.snippetTypes.filter(u=>u.iconInvalid).length,o=[];e>0&&o.push(`${e} missing color`),l>0&&o.push(`${l} missing icon`),i>0&&o.push(`${i} invalid icon`);let r=g.nameEl.createSpan({cls:"detected-snippet-header-warning"});(0,d.setIcon)(r,"alert-triangle"),r.setAttribute("aria-label",o.join(", "))}if(t>0){let l=a.createEl("details",{cls:"detected-snippet-types"});l.createEl("summary",{text:"Show callouts",cls:"detected-snippet-types-summary"});let i=l.createDiv({cls:"detected-snippet-type-row detected-snippet-type-header"});i.createSpan({text:"Icon",cls:"detected-snippet-col-icon"}),i.createSpan({text:"Callout",cls:"detected-snippet-col-callout"}),i.createSpan({text:"Icon Name",cls:"detected-snippet-col-iconname"}),i.createSpan({text:"Color",cls:"detected-snippet-col-color"}),i.createSpan({text:"",cls:"detected-snippet-col-status"});for(let o of this.plugin.snippetTypes){let r=l.createDiv({cls:"detected-snippet-type-row"}),u=r.createDiv({cls:"detected-snippet-col-icon detected-snippet-type-icon"});(0,d.setIcon)(u,o.icon),u.style.setProperty("--callout-color",o.color),r.createSpan({text:o.label,cls:"detected-snippet-col-callout"});let y=o.iconDefault?"\u2014":o.icon,b=r.createSpan({text:y,cls:"detected-snippet-col-iconname detected-snippet-type-meta"});o.iconInvalid&&b.addClass("detected-snippet-type-invalid");let S=o.color.startsWith("var(")?"\u2014":`rgb(${o.color})`;r.createSpan({text:S,cls:"detected-snippet-col-color detected-snippet-type-meta"});let N=r.createDiv({cls:"detected-snippet-col-status"}),D=o.color.startsWith("var("),L=o.iconDefault===!0,O=o.iconInvalid===!0;if(D||L||O){let v=[];D&&v.push("no --callout-color"),L&&v.push("no --callout-icon"),O&&v.push(`unknown icon "${o.icon}"`);let k=N.createDiv({cls:"detected-snippet-type-warning"});(0,d.setIcon)(k,"alert-triangle"),k.setAttribute("aria-label",v.join(", "))}}}if(this.plugin.snippetWarnings.length>0){let l=a.createDiv({cls:"detected-snippet-warnings"}),i=l.createDiv({cls:"detected-snippet-warnings-header"}),o=i.createDiv({cls:"detected-snippet-warnings-icon"});(0,d.setIcon)(o,"alert-triangle"),i.createSpan({text:"Some snippet files contain malformed callout definitions"});let r=l.createEl("ul");for(let u of this.plugin.snippetWarnings)r.createEl("li",{text:`${u.file} \u2014 ${u.malformedCount} malformed ${u.malformedCount===1?"entry":"entries"}`})}}}};
