/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var v=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var A=(r,i)=>{for(var t in i)v(r,t,{get:i[t],enumerable:!0})},P=(r,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let n of D(i))!k.call(r,n)&&n!==t&&v(r,n,{get:()=>i[n],enumerable:!(e=O(i,n))||e.enumerable});return r};var N=r=>P(v({},"__esModule",{value:!0}),r);var $={};A($,{default:()=>S});module.exports=N($);var d=require("obsidian");var E={defaultCalloutType:"note",rememberLastType:!1,autoFocusContent:!0,lastUsedType:"note",scanSnippets:!0},y=[{type:"note",label:"Note",icon:"lucide-pencil",color:"var(--callout-default)",source:"builtin",aliases:[]},{type:"abstract",label:"Abstract",icon:"lucide-clipboard-list",color:"var(--callout-summary)",source:"builtin",aliases:["summary","tldr"]},{type:"info",label:"Info",icon:"lucide-info",color:"var(--callout-info)",source:"builtin",aliases:[]},{type:"todo",label:"Todo",icon:"lucide-check-circle-2",color:"var(--callout-todo)",source:"builtin",aliases:[]},{type:"important",label:"Important",icon:"lucide-flame",color:"var(--callout-important)",source:"builtin",aliases:[]},{type:"tip",label:"Tip",icon:"lucide-flame",color:"var(--callout-tip)",source:"builtin",aliases:["hint"]},{type:"success",label:"Success",icon:"lucide-check",color:"var(--callout-success)",source:"builtin",aliases:["check","done"]},{type:"question",label:"Question",icon:"lucide-help-circle",color:"var(--callout-question)",source:"builtin",aliases:["help","faq"]},{type:"warning",label:"Warning",icon:"lucide-alert-triangle",color:"var(--callout-warning)",source:"builtin",aliases:["caution","attention"]},{type:"failure",label:"Failure",icon:"lucide-x",color:"var(--callout-fail)",source:"builtin",aliases:["fail","missing"]},{type:"danger",label:"Danger",icon:"lucide-zap",color:"var(--callout-error)",source:"builtin",aliases:["error"]},{type:"bug",label:"Bug",icon:"lucide-bug",color:"var(--callout-bug)",source:"builtin",aliases:[]},{type:"example",label:"Example",icon:"lucide-list",color:"var(--callout-example)",source:"builtin",aliases:[]},{type:"quote",label:"Quote",icon:"lucide-quote",color:"var(--callout-quote)",source:"builtin",aliases:["cite"]}];var h=require("obsidian");var b=class extends h.Modal{constructor(t,e){var s,o;super(t);this.config=e;this.title="";this.content="";this.collapse="none";this.builtinOptions=[];this.snippetOptions=[];this.allCalloutOptions=[];this.type=e.defaultType,this.autoFocusContent=e.autoFocusContent,this.containerEl.addClass("insert-callout-modal"),this.prepareCalloutOptions();let n=this.getEditor();if(n){let l=n.getSelection();l&&(this.content=l)}this.allCalloutOptions.find(l=>l.type===this.type)||(this.type=(o=(s=this.allCalloutOptions[0])==null?void 0:s.type)!=null?o:"note")}getEditor(){var t,e;return(e=(t=this.app.workspace.getActiveViewOfType(h.MarkdownView))==null?void 0:t.editor)!=null?e:null}prepareCalloutOptions(){this.snippetOptions=[...this.config.snippetTypes];for(let t of y)if(this.builtinOptions.push({type:t.type,label:t.label,icon:t.icon,color:t.color,source:"builtin"}),t.aliases)for(let e of t.aliases)this.builtinOptions.push({type:e,label:`${t.label} (${e})`,icon:t.icon,color:t.color,source:"builtin"});this.allCalloutOptions=[...this.snippetOptions,...this.builtinOptions]}onOpen(){this.display()}display(){let{contentEl:t}=this;t.empty(),t.addEventListener("keydown",s=>{s.key==="Enter"&&(s.ctrlKey||s.metaKey)&&(s.preventDefault(),this.insertButton&&this.insertButton.click())});let e=t.createDiv("callout-type-container");this.iconContainerEl=e.createDiv("callout-icon-container"),new h.Setting(e).setName("Callout type").addDropdown(s=>{var c,p;let o=s.selectEl;if(this.snippetOptions.length>0){let a=o.createEl("optgroup",{attr:{label:"Custom"}});for(let u of this.snippetOptions)a.createEl("option",{value:u.type,text:u.label})}let l=o.createEl("optgroup",{attr:{label:"Default"}});for(let a of this.builtinOptions)l.createEl("option",{value:a.type,text:a.label});this.allCalloutOptions.some(a=>a.type===this.type)||(this.type=(p=(c=this.allCalloutOptions[0])==null?void 0:c.type)!=null?p:"note"),s.setValue(this.type),s.onChange(a=>{this.type=a,this.updateIconAndColor(this.iconContainerEl,a)})}),this.updateIconAndColor(this.iconContainerEl,this.type),new h.Setting(t).setName("Title").setDesc("Optional, leave blank for default title").addText(s=>{s.setPlaceholder("Input title").setValue(this.title).onChange(o=>{this.title=o})}),new h.Setting(t).setName("Collapse state").addDropdown(s=>{s.addOption("none","Default").addOption("open","Open").addOption("closed","Closed").setValue(this.collapse).onChange(o=>{this.collapse=o})}),new h.Setting(t).setName("Content").addTextArea(s=>{s.setPlaceholder("Input content").setValue(this.content).onChange(o=>{this.content=o}),s.inputEl.rows=5,s.inputEl.cols=40,this.contentTextArea=s.inputEl}),t.createDiv("insert-callout-shortcut-hint").setText(`${h.Platform.isMacOS?"\u2318":"Ctrl"} + Enter to insert`),new h.Setting(t).addButton(s=>(s.setButtonText("Insert").setCta().onClick(()=>{this.insertCallout(),this.close()}),this.insertButton=s.buttonEl,s)).addButton(s=>(s.setButtonText("Cancel").setTooltip("Cancel").onClick(()=>this.close()),s)),this.autoFocusContent&&setTimeout(()=>{this.contentTextArea&&this.contentTextArea.focus()},10)}updateIconAndColor(t,e){if(!t)return;let n=this.allCalloutOptions.find(s=>s.type===e);t.empty(),n?((0,h.setIcon)(t,n.icon),t.style.setProperty("--callout-color",n.color)):((0,h.setIcon)(t,"lucide-alert-circle"),t.style.removeProperty("--callout-color"))}insertCallout(){let t=this.getEditor();if(!t)return;let e=`> [!${this.type}]`;this.collapse!=="none"&&(e+=this.collapse==="open"?"+":"-"),this.title&&(e+=` ${this.title}`),e+=`
> ${this.content.replace(/\n/g,`
> `)}`;let n=t.getCursor(),s=t.getLine(n.line),o=n.ch===0,l;if(t.getSelection()){!o&&s.trim().length>0&&(e=`
`+e);let c=t.getCursor("from");t.replaceSelection(e);let p=e.split(`
`).length;l={line:c.line+p,ch:0}}else{!o&&s.trim().length>0&&(e=`
`+e),t.replaceRange(e,n);let c=e.split(`
`).length;l={line:n.line+c,ch:0}}setTimeout(()=>{t.replaceRange(`
`,l),t.setCursor({line:l.line+1,ch:0}),t.focus()},0)}};var m=require("obsidian");var C=class extends m.SuggestModal{constructor(t,e,n){super(t);this.allCalloutOptions=[];this.onChoose=n,this.setPlaceholder("Choose a callout type..."),this.prepareCalloutOptions(e)}prepareCalloutOptions(t){for(let e of t)this.allCalloutOptions.push(e);for(let e of y)if(this.allCalloutOptions.push(e),e.aliases)for(let n of e.aliases)this.allCalloutOptions.push({type:n,label:`${e.label} (${n})`,icon:e.icon,color:e.color,source:"builtin"})}getSuggestions(t){let e=t.toLowerCase();return e?this.allCalloutOptions.filter(n=>n.type.toLowerCase().includes(e)||n.label.toLowerCase().includes(e)):this.allCalloutOptions}renderSuggestion(t,e){let n=e.createDiv({cls:"quick-pick-callout-item"}),s=n.createDiv({cls:"quick-pick-callout-icon"});(0,m.setIcon)(s,t.icon),s.style.setProperty("--callout-color",t.color),n.createDiv({cls:"quick-pick-callout-label",text:t.label}),t.source!=="builtin"&&n.createDiv({cls:"quick-pick-callout-source",text:t.source})}onChooseSuggestion(t){this.onChoose(t.type)}static insertQuickCallout(t,e){var p,a;let n=(a=(p=t.workspace.getActiveViewOfType(m.MarkdownView))==null?void 0:p.editor)!=null?a:null;if(!n)return;let s=`> [!${e}]
> `,o=n.getCursor(),l=n.getLine(o.line),c=o.ch===0;if(n.getSelection()){let u=n.getSelection();s=`> [!${e}]
> ${u.replace(/\n/g,`
> `)}`,!c&&l.trim().length>0&&(s=`
`+s);let g=n.getCursor("from");n.replaceSelection(s);let f=s.split(`
`).length,T={line:g.line+f,ch:0};setTimeout(()=>{n.replaceRange(`
`,T),n.setCursor({line:T.line+1,ch:0}),n.focus()},0)}else{!c&&l.trim().length>0&&(s=`
`+s),n.replaceRange(s,o);let u=s.split(`
`).length;setTimeout(()=>{n.setCursor({line:o.line+u-1,ch:2}),n.focus()},0)}}};async function L(r){var p;let i=[],t=[],e=new Set;for(let a of y)if(e.add(a.type),a.aliases)for(let u of a.aliases)e.add(u);let s=r.customCss.enabledSnippets,o=`${r.vault.configDir}/snippets`,l;try{l=await r.vault.adapter.list(o)}catch(a){return{types:i,warnings:t}}let c=l.files.filter(a=>{var f;if(!a.endsWith(".css"))return!1;let g=((f=a.split("/").pop())!=null?f:"").replace(/\.css$/,"");return s.has(g)});for(let a of c){let u;try{u=await r.vault.adapter.read(a)}catch(x){continue}let g=u.match(/\.callout\[data-callout/g),f=g?g.length:0,T=B(u,i,e),I=f-T;if(I>0){let x=(p=a.split("/").pop())!=null?p:a;t.push({file:x,malformedCount:I})}}return{types:i,warnings:t}}function B(r,i,t){let e=/\.callout\[data-callout=["']([^"']+)["']\]\s*\{([^}]*)}/g,n,s=0;for(;(n=e.exec(r))!==null;){s++;let o=n[1],l=n[2];if(!o||!l||t.has(o)||i.some(f=>f.type===o))continue;let c=l.match(/--callout-color:\s*([\d\s,]+)/),p=c&&c[1]?c[1].trim():"var(--callout-default)",a=l.match(/--callout-icon:\s*([\w-]+)/),u=a&&a[1]?a[1]:"lucide-box",g=o.replace(/[-_]/g," ").replace(/\b\w/g,f=>f.toUpperCase());i.push({type:o,label:g,icon:u,color:p,source:"snippet"})}return s}var S=class extends d.Plugin{constructor(){super(...arguments);this.snippetTypes=[];this.snippetWarnings=[]}async onload(){await this.loadSettings(),this.addCommand({id:"insert-callout",name:"Insert callout",editorCallback:()=>{let t=this.settings.rememberLastType?this.settings.lastUsedType:this.settings.defaultCalloutType,e=new b(this.app,{defaultType:t,autoFocusContent:this.settings.autoFocusContent,snippetTypes:this.snippetTypes}),n=e.close.bind(e);e.close=()=>{this.settings.rememberLastType&&e.type&&(this.settings.lastUsedType=e.type,this.saveSettings()),n()},e.open()}}),this.addCommand({id:"insert-callout-quick",name:"Insert callout (quick pick)",editorCallback:()=>{new C(this.app,this.snippetTypes,e=>{C.insertQuickCallout(this.app,e),this.settings.rememberLastType&&(this.settings.lastUsedType=e,this.saveSettings())}).open()}}),this.addCommand({id:"open-settings",name:"Open settings",callback:()=>{let t=this.app.setting;t.open(),t.openTabById(this.manifest.id)}}),this.addSettingTab(new w(this.app,this)),this.app.workspace.onLayoutReady(()=>{this.refreshSnippetTypes()})}async loadSettings(){this.settings=Object.assign({},E,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async refreshSnippetTypes(){if(this.settings.scanSnippets){let t=await L(this.app);this.snippetTypes=t.types,this.snippetWarnings=t.warnings}else this.snippetTypes=[],this.snippetWarnings=[]}},w=class extends d.PluginSettingTab{constructor(i,t){super(i,t),this.plugin=t}display(){let{containerEl:i}=this;if(i.empty(),new d.Setting(i).setName("Insertion").setHeading(),new d.Setting(i).setName("Default callout type").setDesc("The callout type pre-selected when the modal opens.").addDropdown(t=>{for(let e of y)t.addOption(e.type,e.label);for(let e of this.plugin.snippetTypes)t.addOption(e.type,e.label);t.setValue(this.plugin.settings.defaultCalloutType),t.onChange(async e=>{this.plugin.settings.defaultCalloutType=e,await this.plugin.saveSettings()})}),new d.Setting(i).setName("Remember last used type").setDesc("When enabled, the modal will default to the last callout type you inserted.").addToggle(t=>{t.setValue(this.plugin.settings.rememberLastType),t.onChange(async e=>{this.plugin.settings.rememberLastType=e,await this.plugin.saveSettings()})}),new d.Setting(i).setName("Auto-focus content").setDesc("Automatically focus the content textarea when the modal opens.").addToggle(t=>{t.setValue(this.plugin.settings.autoFocusContent),t.onChange(async e=>{this.plugin.settings.autoFocusContent=e,await this.plugin.saveSettings()})}),new d.Setting(i).setName("Detection").setHeading(),new d.Setting(i).setName("Scan CSS snippets").setDesc("Detect custom callout types defined in your enabled CSS snippet files.").addToggle(t=>{t.setValue(this.plugin.settings.scanSnippets),t.onChange(async e=>{this.plugin.settings.scanSnippets=e,await this.plugin.saveSettings(),await this.plugin.refreshSnippetTypes(),this.display()})}),this.plugin.settings.scanSnippets){let t=this.plugin.snippetTypes.length,e=t>0?`Detected types (${t})`:"No custom types detected",n=t>0?"Custom callout types found in your enabled CSS snippets.":"No callout definitions were found in your enabled CSS snippet files.";if(new d.Setting(i).setName(e).setDesc(n).addExtraButton(s=>{s.setIcon("refresh-cw").setTooltip("Refresh snippets").onClick(async()=>{await this.plugin.refreshSnippetTypes(),this.display()})}).addExtraButton(s=>{s.setIcon("folder-open").setTooltip("Open snippets folder").onClick(()=>{let o=`${this.app.vault.configDir}/snippets`;this.app.openWithDefaultApp(o)})}),t>0){let s=i.createDiv({cls:"detected-snippet-types"}),o=s.createDiv({cls:"detected-snippet-type-row detected-snippet-type-header"});o.createSpan({text:"Icon",cls:"detected-snippet-col-icon"}),o.createSpan({text:"Callout",cls:"detected-snippet-col-callout"}),o.createSpan({text:"Icon Name",cls:"detected-snippet-col-iconname"}),o.createSpan({text:"Color",cls:"detected-snippet-col-color"}),o.createSpan({text:"",cls:"detected-snippet-col-status"});for(let l of this.plugin.snippetTypes){let c=s.createDiv({cls:"detected-snippet-type-row"}),p=c.createDiv({cls:"detected-snippet-col-icon detected-snippet-type-icon"});(0,d.setIcon)(p,l.icon),p.style.setProperty("--callout-color",l.color),c.createSpan({text:l.label,cls:"detected-snippet-col-callout"}),c.createSpan({text:l.icon,cls:"detected-snippet-col-iconname detected-snippet-type-meta"});let a=l.color.startsWith("var(")?"\u2014":`rgb(${l.color})`;c.createSpan({text:a,cls:"detected-snippet-col-color detected-snippet-type-meta"});let u=c.createDiv({cls:"detected-snippet-col-status"});if(l.color.startsWith("var(")){let g=u.createDiv({cls:"detected-snippet-type-warning"});(0,d.setIcon)(g,"alert-triangle"),g.setAttribute("aria-label","No color defined \u2014 using default")}}}if(this.plugin.snippetWarnings.length>0){let s=i.createDiv({cls:"detected-snippet-warnings"}),o=s.createDiv({cls:"detected-snippet-warnings-header"}),l=o.createDiv({cls:"detected-snippet-warnings-icon"});(0,d.setIcon)(l,"alert-triangle"),o.createSpan({text:"Some snippet files contain malformed callout definitions"});let c=s.createEl("ul");for(let p of this.plugin.snippetWarnings)c.createEl("li",{text:`${p.file} \u2014 ${p.malformedCount} malformed ${p.malformedCount===1?"entry":"entries"}`})}}}};
