/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var w=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var A=(u,l)=>{for(var t in l)w(u,t,{get:l[t],enumerable:!0})},P=(u,l,t,e)=>{if(l&&typeof l=="object"||typeof l=="function")for(let s of D(l))!k.call(u,s)&&s!==t&&w(u,s,{get:()=>l[s],enumerable:!(e=O(l,s))||e.enumerable});return u};var N=u=>P(w({},"__esModule",{value:!0}),u);var B={};A(B,{default:()=>S});module.exports=N(B);var d=require("obsidian");var E={defaultCalloutType:"note",rememberLastType:!1,autoFocusContent:!0,lastUsedType:"note",scanSnippets:!0},y=[{type:"note",label:"Note",icon:"lucide-pencil",color:"var(--callout-default)",source:"builtin",aliases:[]},{type:"abstract",label:"Abstract",icon:"lucide-clipboard-list",color:"var(--callout-summary)",source:"builtin",aliases:["summary","tldr"]},{type:"info",label:"Info",icon:"lucide-info",color:"var(--callout-info)",source:"builtin",aliases:[]},{type:"todo",label:"Todo",icon:"lucide-check-circle-2",color:"var(--callout-todo)",source:"builtin",aliases:[]},{type:"important",label:"Important",icon:"lucide-flame",color:"var(--callout-important)",source:"builtin",aliases:[]},{type:"tip",label:"Tip",icon:"lucide-flame",color:"var(--callout-tip)",source:"builtin",aliases:["hint"]},{type:"success",label:"Success",icon:"lucide-check",color:"var(--callout-success)",source:"builtin",aliases:["check","done"]},{type:"question",label:"Question",icon:"lucide-help-circle",color:"var(--callout-question)",source:"builtin",aliases:["help","faq"]},{type:"warning",label:"Warning",icon:"lucide-alert-triangle",color:"var(--callout-warning)",source:"builtin",aliases:["caution","attention"]},{type:"failure",label:"Failure",icon:"lucide-x",color:"var(--callout-fail)",source:"builtin",aliases:["fail","missing"]},{type:"danger",label:"Danger",icon:"lucide-zap",color:"var(--callout-error)",source:"builtin",aliases:["error"]},{type:"bug",label:"Bug",icon:"lucide-bug",color:"var(--callout-bug)",source:"builtin",aliases:[]},{type:"example",label:"Example",icon:"lucide-list",color:"var(--callout-example)",source:"builtin",aliases:[]},{type:"quote",label:"Quote",icon:"lucide-quote",color:"var(--callout-quote)",source:"builtin",aliases:["cite"]}];var h=require("obsidian");var b=class extends h.Modal{constructor(t,e){var n,a;super(t);this.config=e;this.title="";this.content="";this.collapse="none";this.builtinOptions=[];this.snippetOptions=[];this.allCalloutOptions=[];this.type=e.defaultType,this.autoFocusContent=e.autoFocusContent,this.containerEl.addClass("insert-callout-modal"),this.prepareCalloutOptions();let s=this.getEditor();if(s){let i=s.getSelection();i&&(this.content=i)}this.allCalloutOptions.find(i=>i.type===this.type)||(this.type=(a=(n=this.allCalloutOptions[0])==null?void 0:n.type)!=null?a:"note")}getEditor(){var t,e;return(e=(t=this.app.workspace.getActiveViewOfType(h.MarkdownView))==null?void 0:t.editor)!=null?e:null}prepareCalloutOptions(){this.snippetOptions=[...this.config.snippetTypes];for(let t of y)if(this.builtinOptions.push({type:t.type,label:t.label,icon:t.icon,color:t.color,source:"builtin"}),t.aliases)for(let e of t.aliases)this.builtinOptions.push({type:e,label:`${t.label} (${e})`,icon:t.icon,color:t.color,source:"builtin"});this.allCalloutOptions=[...this.snippetOptions,...this.builtinOptions]}onOpen(){this.display()}display(){let{contentEl:t}=this;t.empty(),t.addEventListener("keydown",n=>{n.key==="Enter"&&(n.ctrlKey||n.metaKey)&&(n.preventDefault(),this.insertButton&&this.insertButton.click())});let e=t.createDiv("callout-type-container");this.iconContainerEl=e.createDiv("callout-icon-container"),new h.Setting(e).setName("Callout type").addDropdown(n=>{var c,p;let a=n.selectEl;if(this.snippetOptions.length>0){let o=a.createEl("optgroup",{attr:{label:"Custom"}});for(let r of this.snippetOptions)o.createEl("option",{value:r.type,text:r.label})}let i=a.createEl("optgroup",{attr:{label:"Default"}});for(let o of this.builtinOptions)i.createEl("option",{value:o.type,text:o.label});this.allCalloutOptions.some(o=>o.type===this.type)||(this.type=(p=(c=this.allCalloutOptions[0])==null?void 0:c.type)!=null?p:"note"),n.setValue(this.type),n.onChange(o=>{this.type=o,this.updateIconAndColor(this.iconContainerEl,o)})}),this.updateIconAndColor(this.iconContainerEl,this.type),new h.Setting(t).setName("Title").setDesc("Optional, leave blank for default title").addText(n=>{n.setPlaceholder("Input title").setValue(this.title).onChange(a=>{this.title=a})}),new h.Setting(t).setName("Collapse state").addDropdown(n=>{n.addOption("none","Default").addOption("open","Open").addOption("closed","Closed").setValue(this.collapse).onChange(a=>{this.collapse=a})}),new h.Setting(t).setName("Content").addTextArea(n=>{n.setPlaceholder("Input content").setValue(this.content).onChange(a=>{this.content=a}),n.inputEl.rows=5,n.inputEl.cols=40,this.contentTextArea=n.inputEl}),t.createDiv("insert-callout-shortcut-hint").setText(`${h.Platform.isMacOS?"\u2318":"Ctrl"} + Enter to insert`),new h.Setting(t).addButton(n=>(n.setButtonText("Insert").setCta().onClick(()=>{this.insertCallout(),this.close()}),this.insertButton=n.buttonEl,n)).addButton(n=>(n.setButtonText("Cancel").setTooltip("Cancel").onClick(()=>this.close()),n)),this.autoFocusContent&&setTimeout(()=>{this.contentTextArea&&this.contentTextArea.focus()},10)}updateIconAndColor(t,e){if(!t)return;let s=this.allCalloutOptions.find(n=>n.type===e);t.empty(),s?((0,h.setIcon)(t,s.icon),t.style.setProperty("--callout-color",s.color)):((0,h.setIcon)(t,"lucide-alert-circle"),t.style.removeProperty("--callout-color"))}insertCallout(){let t=this.getEditor();if(!t)return;let e=`> [!${this.type}]`;this.collapse!=="none"&&(e+=this.collapse==="open"?"+":"-"),this.title&&(e+=` ${this.title}`),e+=`
> ${this.content.replace(/\n/g,`
> `)}`;let s=t.getCursor(),n=t.getLine(s.line),a=s.ch===0,i;if(t.getSelection()){!a&&n.trim().length>0&&(e=`
`+e);let c=t.getCursor("from");t.replaceSelection(e);let p=e.split(`
`).length;i={line:c.line+p,ch:0}}else{!a&&n.trim().length>0&&(e=`
`+e),t.replaceRange(e,s);let c=e.split(`
`).length;i={line:s.line+c,ch:0}}setTimeout(()=>{t.replaceRange(`
`,i),t.setCursor({line:i.line+1,ch:0}),t.focus()},0)}};var C=require("obsidian");var T=class extends C.SuggestModal{constructor(t,e,s){super(t);this.allCalloutOptions=[];this.onChoose=s,this.setPlaceholder("Choose a callout type..."),this.prepareCalloutOptions(e)}prepareCalloutOptions(t){for(let e of t)this.allCalloutOptions.push(e);for(let e of y)if(this.allCalloutOptions.push(e),e.aliases)for(let s of e.aliases)this.allCalloutOptions.push({type:s,label:`${e.label} (${s})`,icon:e.icon,color:e.color,source:"builtin"})}getSuggestions(t){let e=t.toLowerCase();return e?this.allCalloutOptions.filter(s=>s.type.toLowerCase().includes(e)||s.label.toLowerCase().includes(e)):this.allCalloutOptions}renderSuggestion(t,e){let s=e.createDiv({cls:"quick-pick-callout-item"}),n=s.createDiv({cls:"quick-pick-callout-icon"});(0,C.setIcon)(n,t.icon),n.style.setProperty("--callout-color",t.color),s.createDiv({cls:"quick-pick-callout-label",text:t.label}),t.source!=="builtin"&&s.createDiv({cls:"quick-pick-callout-source",text:t.source})}onChooseSuggestion(t){this.onChoose(t.type)}static insertQuickCallout(t,e){var p,o;let s=(o=(p=t.workspace.getActiveViewOfType(C.MarkdownView))==null?void 0:p.editor)!=null?o:null;if(!s)return;let n=`> [!${e}]
> `,a=s.getCursor(),i=s.getLine(a.line),c=a.ch===0;if(s.getSelection()){let r=s.getSelection();n=`> [!${e}]
> ${r.replace(/\n/g,`
> `)}`,!c&&i.trim().length>0&&(n=`
`+n);let f=s.getCursor("from");s.replaceSelection(n);let g=n.split(`
`).length,m={line:f.line+g,ch:0};setTimeout(()=>{s.replaceRange(`
`,m),s.setCursor({line:m.line+1,ch:0}),s.focus()},0)}else{!c&&i.trim().length>0&&(n=`
`+n),s.replaceRange(n,a);let r=n.split(`
`).length;setTimeout(()=>{s.setCursor({line:a.line+r-1,ch:2}),s.focus()},0)}}};async function L(u){var p;let l=[],t=[],e=new Set;for(let o of y)if(e.add(o.type),o.aliases)for(let r of o.aliases)e.add(r);let n=u.customCss.enabledSnippets,a=`${u.vault.configDir}/snippets`,i;try{i=await u.vault.adapter.list(a)}catch(o){return{types:l,warnings:t}}let c=i.files.filter(o=>{var g;if(!o.endsWith(".css"))return!1;let f=((g=o.split("/").pop())!=null?g:"").replace(/\.css$/,"");return n.has(f)});for(let o of c){let r;try{r=await u.vault.adapter.read(o)}catch(x){continue}let f=r.match(/\.callout\[data-callout/g),g=f?f.length:0,m=$(r,l,e),I=g-m;if(I>0){let x=(p=o.split("/").pop())!=null?p:o;t.push({file:x,malformedCount:I})}}return{types:l,warnings:t}}function $(u,l,t){let e=/\.callout\[data-callout=["']([^"']+)["']\]\s*\{([^}]*)}/g,s,n=0;for(;(s=e.exec(u))!==null;){n++;let a=s[1],i=s[2];if(!a||!i||t.has(a)||l.some(g=>g.type===a))continue;let c=i.match(/--callout-color:\s*([\d\s,]+)/),p=c&&c[1]?c[1].trim():"var(--callout-default)",o=i.match(/--callout-icon:\s*([\w-]+)/),r=o&&o[1]?o[1]:"lucide-box",f=a.replace(/[-_]/g," ").replace(/\b\w/g,g=>g.toUpperCase());l.push({type:a,label:f,icon:r,color:p,source:"snippet"})}return n}var S=class extends d.Plugin{constructor(){super(...arguments);this.snippetTypes=[];this.snippetWarnings=[]}async onload(){await this.loadSettings(),this.addCommand({id:"insert-callout",name:"Insert callout",editorCallback:()=>{let t=this.settings.rememberLastType?this.settings.lastUsedType:this.settings.defaultCalloutType,e=new b(this.app,{defaultType:t,autoFocusContent:this.settings.autoFocusContent,snippetTypes:this.snippetTypes}),s=e.close.bind(e);e.close=()=>{this.settings.rememberLastType&&e.type&&(this.settings.lastUsedType=e.type,this.saveSettings()),s()},e.open()}}),this.addCommand({id:"insert-callout-quick",name:"Insert callout (quick pick)",editorCallback:()=>{new T(this.app,this.snippetTypes,e=>{T.insertQuickCallout(this.app,e),this.settings.rememberLastType&&(this.settings.lastUsedType=e,this.saveSettings())}).open()}}),this.addCommand({id:"open-settings",name:"Open settings",callback:()=>{let t=this.app.setting;t.open(),t.openTabById(this.manifest.id)}}),this.addSettingTab(new v(this.app,this)),this.app.workspace.onLayoutReady(()=>{this.refreshSnippetTypes()})}async loadSettings(){this.settings=Object.assign({},E,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async refreshSnippetTypes(){if(this.settings.scanSnippets){let t=await L(this.app);this.snippetTypes=t.types,this.snippetWarnings=t.warnings}else this.snippetTypes=[],this.snippetWarnings=[]}},v=class extends d.PluginSettingTab{constructor(l,t){super(l,t),this.plugin=t}display(){let{containerEl:l}=this;if(l.empty(),new d.Setting(l).setName("Insertion").setHeading(),new d.Setting(l).setName("Default callout type").setDesc("The callout type pre-selected when the modal opens.").addDropdown(t=>{for(let e of y)t.addOption(e.type,e.label);for(let e of this.plugin.snippetTypes)t.addOption(e.type,e.label);t.setValue(this.plugin.settings.defaultCalloutType),t.onChange(async e=>{this.plugin.settings.defaultCalloutType=e,await this.plugin.saveSettings()})}),new d.Setting(l).setName("Remember last used type").setDesc("When enabled, the modal will default to the last callout type you inserted.").addToggle(t=>{t.setValue(this.plugin.settings.rememberLastType),t.onChange(async e=>{this.plugin.settings.rememberLastType=e,await this.plugin.saveSettings()})}),new d.Setting(l).setName("Auto-focus content").setDesc("Automatically focus the content textarea when the modal opens.").addToggle(t=>{t.setValue(this.plugin.settings.autoFocusContent),t.onChange(async e=>{this.plugin.settings.autoFocusContent=e,await this.plugin.saveSettings()})}),new d.Setting(l).setName("Detection").setHeading(),new d.Setting(l).setName("Scan CSS snippets").setDesc("Detect custom callout types defined in your enabled CSS snippet files.").addToggle(t=>{t.setValue(this.plugin.settings.scanSnippets),t.onChange(async e=>{this.plugin.settings.scanSnippets=e,await this.plugin.saveSettings(),await this.plugin.refreshSnippetTypes(),this.display()})}),this.plugin.settings.scanSnippets){let t=this.plugin.snippetTypes.length,e=this.plugin.snippetTypes.filter(i=>i.color.startsWith("var(")).length,s=t>0?`Detected types (${t})`:"No custom types detected",n=t>0?"Custom callout types found in your enabled CSS snippets.":"No callout definitions were found in your enabled CSS snippet files.",a=new d.Setting(l).setName(s).setDesc(n).addExtraButton(i=>{i.setIcon("refresh-cw").setTooltip("Refresh snippets").onClick(async()=>{await this.plugin.refreshSnippetTypes(),this.display()})}).addExtraButton(i=>{i.setIcon("folder-open").setTooltip("Open snippets folder").onClick(()=>{let c=`${this.app.vault.configDir}/snippets`;this.app.openWithDefaultApp(c)})});if(e>0){let i=a.nameEl.createSpan({cls:"detected-snippet-header-warning"});(0,d.setIcon)(i,"alert-triangle"),i.setAttribute("aria-label",`${e} ${e===1?"type":"types"} missing a color definition`)}if(t>0){let i=l.createEl("details",{cls:"detected-snippet-types"});i.createEl("summary",{text:"Show callouts",cls:"detected-snippet-types-summary"});let c=i.createDiv({cls:"detected-snippet-type-row detected-snippet-type-header"});c.createSpan({text:"Icon",cls:"detected-snippet-col-icon"}),c.createSpan({text:"Callout",cls:"detected-snippet-col-callout"}),c.createSpan({text:"Icon Name",cls:"detected-snippet-col-iconname"}),c.createSpan({text:"Color",cls:"detected-snippet-col-color"}),c.createSpan({text:"",cls:"detected-snippet-col-status"});for(let p of this.plugin.snippetTypes){let o=i.createDiv({cls:"detected-snippet-type-row"}),r=o.createDiv({cls:"detected-snippet-col-icon detected-snippet-type-icon"});(0,d.setIcon)(r,p.icon),r.style.setProperty("--callout-color",p.color),o.createSpan({text:p.label,cls:"detected-snippet-col-callout"}),o.createSpan({text:p.icon,cls:"detected-snippet-col-iconname detected-snippet-type-meta"});let f=p.color.startsWith("var(")?"\u2014":`rgb(${p.color})`;o.createSpan({text:f,cls:"detected-snippet-col-color detected-snippet-type-meta"});let g=o.createDiv({cls:"detected-snippet-col-status"});if(p.color.startsWith("var(")){let m=g.createDiv({cls:"detected-snippet-type-warning"});(0,d.setIcon)(m,"alert-triangle"),m.setAttribute("aria-label","No color defined \u2014 using default")}}}if(this.plugin.snippetWarnings.length>0){let i=l.createDiv({cls:"detected-snippet-warnings"}),c=i.createDiv({cls:"detected-snippet-warnings-header"}),p=c.createDiv({cls:"detected-snippet-warnings-icon"});(0,d.setIcon)(p,"alert-triangle"),c.createSpan({text:"Some snippet files contain malformed callout definitions"});let o=i.createEl("ul");for(let r of this.plugin.snippetWarnings)o.createEl("li",{text:`${r.file} \u2014 ${r.malformedCount} malformed ${r.malformedCount===1?"entry":"entries"}`})}}}};
