/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var x=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var W=Object.prototype.hasOwnProperty;var $=(r,l)=>{for(var t in l)x(r,t,{get:l[t],enumerable:!0})},B=(r,l,t,e)=>{if(l&&typeof l=="object"||typeof l=="function")for(let s of N(l))!W.call(r,s)&&s!==t&&x(r,s,{get:()=>l[s],enumerable:!(e=P(l,s))||e.enumerable});return r};var U=r=>B(x({},"__esModule",{value:!0}),r);var F={};$(F,{default:()=>w});module.exports=U(F);var d=require("obsidian");var k={defaultCalloutType:"note",rememberLastType:!1,autoFocusContent:!0,lastUsedType:"note",scanSnippets:!0},m=[{type:"note",label:"Note",icon:"lucide-pencil",color:"var(--callout-default)",source:"builtin",aliases:[]},{type:"abstract",label:"Abstract",icon:"lucide-clipboard-list",color:"var(--callout-summary)",source:"builtin",aliases:["summary","tldr"]},{type:"info",label:"Info",icon:"lucide-info",color:"var(--callout-info)",source:"builtin",aliases:[]},{type:"todo",label:"Todo",icon:"lucide-check-circle-2",color:"var(--callout-todo)",source:"builtin",aliases:[]},{type:"important",label:"Important",icon:"lucide-flame",color:"var(--callout-important)",source:"builtin",aliases:[]},{type:"tip",label:"Tip",icon:"lucide-flame",color:"var(--callout-tip)",source:"builtin",aliases:["hint"]},{type:"success",label:"Success",icon:"lucide-check",color:"var(--callout-success)",source:"builtin",aliases:["check","done"]},{type:"question",label:"Question",icon:"lucide-help-circle",color:"var(--callout-question)",source:"builtin",aliases:["help","faq"]},{type:"warning",label:"Warning",icon:"lucide-alert-triangle",color:"var(--callout-warning)",source:"builtin",aliases:["caution","attention"]},{type:"failure",label:"Failure",icon:"lucide-x",color:"var(--callout-fail)",source:"builtin",aliases:["fail","missing"]},{type:"danger",label:"Danger",icon:"lucide-zap",color:"var(--callout-error)",source:"builtin",aliases:["error"]},{type:"bug",label:"Bug",icon:"lucide-bug",color:"var(--callout-bug)",source:"builtin",aliases:[]},{type:"example",label:"Example",icon:"lucide-list",color:"var(--callout-example)",source:"builtin",aliases:[]},{type:"quote",label:"Quote",icon:"lucide-quote",color:"var(--callout-quote)",source:"builtin",aliases:["cite"]}];var f=require("obsidian");var v=class extends f.Modal{constructor(t,e){var n,a;super(t);this.config=e;this.title="";this.content="";this.collapse="none";this.builtinOptions=[];this.snippetOptions=[];this.allCalloutOptions=[];this.type=e.defaultType,this.autoFocusContent=e.autoFocusContent,this.containerEl.addClass("insert-callout-modal"),this.prepareCalloutOptions();let s=this.getEditor();if(s){let p=s.getSelection();p&&(this.content=p)}this.allCalloutOptions.find(p=>p.type===this.type)||(this.type=(a=(n=this.allCalloutOptions[0])==null?void 0:n.type)!=null?a:"note")}getEditor(){var t,e;return(e=(t=this.app.workspace.getActiveViewOfType(f.MarkdownView))==null?void 0:t.editor)!=null?e:null}prepareCalloutOptions(){this.snippetOptions=[...this.config.snippetTypes];for(let t of m)if(this.builtinOptions.push({type:t.type,label:t.label,icon:t.icon,color:t.color,source:"builtin"}),t.aliases)for(let e of t.aliases)this.builtinOptions.push({type:e,label:`${t.label} (${e})`,icon:t.icon,color:t.color,source:"builtin"});this.allCalloutOptions=[...this.snippetOptions,...this.builtinOptions]}onOpen(){this.display()}display(){let{contentEl:t}=this;t.empty(),t.addEventListener("keydown",n=>{n.key==="Enter"&&(n.ctrlKey||n.metaKey)&&(n.preventDefault(),this.insertButton&&this.insertButton.click())});let e=t.createDiv("callout-type-container");this.iconContainerEl=e.createDiv("callout-icon-container"),new f.Setting(e).setName("Callout type").addDropdown(n=>{var u,o;let a=n.selectEl;if(this.snippetOptions.length>0){let i=a.createEl("optgroup",{attr:{label:"Custom"}});for(let c of this.snippetOptions)i.createEl("option",{value:c.type,text:c.label})}let p=a.createEl("optgroup",{attr:{label:"Default"}});for(let i of this.builtinOptions)p.createEl("option",{value:i.type,text:i.label});this.allCalloutOptions.some(i=>i.type===this.type)||(this.type=(o=(u=this.allCalloutOptions[0])==null?void 0:u.type)!=null?o:"note"),n.setValue(this.type),n.onChange(i=>{this.type=i,this.updateIconAndColor(this.iconContainerEl,i)})}),this.updateIconAndColor(this.iconContainerEl,this.type),new f.Setting(t).setName("Title").setDesc("Optional, leave blank for default title").addText(n=>{n.setPlaceholder("Input title").setValue(this.title).onChange(a=>{this.title=a})}),new f.Setting(t).setName("Collapse state").addDropdown(n=>{n.addOption("none","Default").addOption("open","Open").addOption("closed","Closed").setValue(this.collapse).onChange(a=>{this.collapse=a})}),new f.Setting(t).setName("Content").addTextArea(n=>{n.setPlaceholder("Input content").setValue(this.content).onChange(a=>{this.content=a}),n.inputEl.rows=5,n.inputEl.cols=40,this.contentTextArea=n.inputEl}),t.createDiv("insert-callout-shortcut-hint").setText(`${f.Platform.isMacOS?"\u2318":"Ctrl"} + Enter to insert`),new f.Setting(t).addButton(n=>(n.setButtonText("Insert").setCta().onClick(()=>{this.insertCallout(),this.close()}),this.insertButton=n.buttonEl,n)).addButton(n=>(n.setButtonText("Cancel").setTooltip("Cancel").onClick(()=>this.close()),n)),this.autoFocusContent&&setTimeout(()=>{this.contentTextArea&&this.contentTextArea.focus()},10)}updateIconAndColor(t,e){if(!t)return;let s=this.allCalloutOptions.find(n=>n.type===e);t.empty(),s?((0,f.setIcon)(t,s.icon),t.style.setProperty("--callout-color",s.color)):((0,f.setIcon)(t,"lucide-alert-circle"),t.style.removeProperty("--callout-color"))}insertCallout(){let t=this.getEditor();if(!t)return;let e=`> [!${this.type}]`;this.collapse!=="none"&&(e+=this.collapse==="open"?"+":"-"),this.title&&(e+=` ${this.title}`),e+=`
> ${this.content.replace(/\n/g,`
> `)}`;let s=t.getCursor(),n=t.getLine(s.line),a=s.ch===0,p;if(t.getSelection()){!a&&n.trim().length>0&&(e=`
`+e);let u=t.getCursor("from");t.replaceSelection(e);let o=e.split(`
`).length;p={line:u.line+o,ch:0}}else{!a&&n.trim().length>0&&(e=`
`+e),t.replaceRange(e,s);let u=e.split(`
`).length;p={line:s.line+u,ch:0}}setTimeout(()=>{t.replaceRange(`
`,p),t.setCursor({line:p.line+1,ch:0}),t.focus()},0)}};var C=require("obsidian");var T=class extends C.SuggestModal{constructor(t,e,s){super(t);this.allCalloutOptions=[];this.onChoose=s,this.setPlaceholder("Choose a callout type..."),this.prepareCalloutOptions(e)}prepareCalloutOptions(t){for(let e of t)this.allCalloutOptions.push(e);for(let e of m)if(this.allCalloutOptions.push(e),e.aliases)for(let s of e.aliases)this.allCalloutOptions.push({type:s,label:`${e.label} (${s})`,icon:e.icon,color:e.color,source:"builtin"})}getSuggestions(t){let e=t.toLowerCase();return e?this.allCalloutOptions.filter(s=>s.type.toLowerCase().includes(e)||s.label.toLowerCase().includes(e)):this.allCalloutOptions}renderSuggestion(t,e){let s=e.createDiv({cls:"quick-pick-callout-item"}),n=s.createDiv({cls:"quick-pick-callout-icon"});(0,C.setIcon)(n,t.icon),n.style.setProperty("--callout-color",t.color),s.createDiv({cls:"quick-pick-callout-label",text:t.label}),t.source!=="builtin"&&s.createDiv({cls:"quick-pick-callout-source",text:t.source})}onChooseSuggestion(t){this.onChoose(t.type)}static insertQuickCallout(t,e){var o,i;let s=(i=(o=t.workspace.getActiveViewOfType(C.MarkdownView))==null?void 0:o.editor)!=null?i:null;if(!s)return;let n=`> [!${e}]
> `,a=s.getCursor(),p=s.getLine(a.line),u=a.ch===0;if(s.getSelection()){let c=s.getSelection();n=`> [!${e}]
> ${c.replace(/\n/g,`
> `)}`,!u&&p.trim().length>0&&(n=`
`+n);let h=s.getCursor("from");s.replaceSelection(n);let g=n.split(`
`).length,y={line:h.line+g,ch:0};setTimeout(()=>{s.replaceRange(`
`,y),s.setCursor({line:y.line+1,ch:0}),s.focus()},0)}else{!u&&p.trim().length>0&&(n=`
`+n),s.replaceRange(n,a);let c=n.split(`
`).length;setTimeout(()=>{s.setCursor({line:a.line+c-1,ch:2}),s.focus()},0)}}};async function A(r){var o;let l=[],t=[],e=new Set;for(let i of m)if(e.add(i.type),i.aliases)for(let c of i.aliases)e.add(c);let n=r.customCss.enabledSnippets,a=`${r.vault.configDir}/snippets`,p;try{p=await r.vault.adapter.list(a)}catch(i){return{types:l,warnings:t}}let u=p.files.filter(i=>{var g;if(!i.endsWith(".css"))return!1;let h=((g=i.split("/").pop())!=null?g:"").replace(/\.css$/,"");return n.has(h)});for(let i of u){let c;try{c=await r.vault.adapter.read(i)}catch(S){continue}let h=c.match(/\.callout\[data-callout/g),g=h?h.length:0,y=M(c,l,e),b=g-y;if(b>0){let S=(o=i.split("/").pop())!=null?o:i;t.push({file:S,malformedCount:b})}}return{types:l,warnings:t}}function M(r,l,t){let e=/\.callout\[data-callout=["']([^"']+)["']\]\s*\{([^}]*)}/g,s,n=0;for(;(s=e.exec(r))!==null;){n++;let a=s[1],p=s[2];if(!a||!p||t.has(a)||l.some(y=>y.type===a))continue;let u=p.match(/--callout-color:\s*([\d\s,]+)/),o=u&&u[1]?u[1].trim():"var(--callout-default)",i=p.match(/--callout-icon:\s*([\w-]+)/),c=i&&i[1]?i[1]:"lucide-box",h=!(i&&i[1]),g=a.replace(/[-_]/g," ").replace(/\b\w/g,y=>y.toUpperCase());l.push({type:a,label:g,icon:c,color:o,source:"snippet",iconDefault:h})}return n}var w=class extends d.Plugin{constructor(){super(...arguments);this.snippetTypes=[];this.snippetWarnings=[]}async onload(){await this.loadSettings(),this.addCommand({id:"insert-callout",name:"Insert callout",editorCallback:()=>{let t=this.settings.rememberLastType?this.settings.lastUsedType:this.settings.defaultCalloutType,e=new v(this.app,{defaultType:t,autoFocusContent:this.settings.autoFocusContent,snippetTypes:this.snippetTypes}),s=e.close.bind(e);e.close=()=>{this.settings.rememberLastType&&e.type&&(this.settings.lastUsedType=e.type,this.saveSettings()),s()},e.open()}}),this.addCommand({id:"insert-callout-quick",name:"Insert callout (quick pick)",editorCallback:()=>{new T(this.app,this.snippetTypes,e=>{T.insertQuickCallout(this.app,e),this.settings.rememberLastType&&(this.settings.lastUsedType=e,this.saveSettings())}).open()}}),this.addCommand({id:"open-settings",name:"Open settings",callback:()=>{let t=this.app.setting;t.open(),t.openTabById(this.manifest.id)}}),this.addSettingTab(new E(this.app,this)),this.app.workspace.onLayoutReady(()=>{this.refreshSnippetTypes()})}async loadSettings(){this.settings=Object.assign({},k,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async refreshSnippetTypes(){if(this.settings.scanSnippets){let t=await A(this.app);this.snippetTypes=t.types,this.snippetWarnings=t.warnings}else this.snippetTypes=[],this.snippetWarnings=[]}},E=class extends d.PluginSettingTab{constructor(l,t){super(l,t),this.plugin=t}display(){let{containerEl:l}=this;if(l.empty(),new d.Setting(l).setName("Insertion").setHeading(),new d.Setting(l).setName("Default callout type").setDesc("The callout type pre-selected when the modal opens.").addDropdown(t=>{for(let e of m)t.addOption(e.type,e.label);for(let e of this.plugin.snippetTypes)t.addOption(e.type,e.label);t.setValue(this.plugin.settings.defaultCalloutType),t.onChange(async e=>{this.plugin.settings.defaultCalloutType=e,await this.plugin.saveSettings()})}),new d.Setting(l).setName("Remember last used type").setDesc("When enabled, the modal will default to the last callout type you inserted.").addToggle(t=>{t.setValue(this.plugin.settings.rememberLastType),t.onChange(async e=>{this.plugin.settings.rememberLastType=e,await this.plugin.saveSettings()})}),new d.Setting(l).setName("Auto-focus content").setDesc("Automatically focus the content textarea when the modal opens.").addToggle(t=>{t.setValue(this.plugin.settings.autoFocusContent),t.onChange(async e=>{this.plugin.settings.autoFocusContent=e,await this.plugin.saveSettings()})}),new d.Setting(l).setName("Detection").setHeading(),new d.Setting(l).setName("Scan CSS snippets").setDesc("Detect custom callout types defined in your enabled CSS snippet files.").addToggle(t=>{t.setValue(this.plugin.settings.scanSnippets),t.onChange(async e=>{this.plugin.settings.scanSnippets=e,await this.plugin.saveSettings(),await this.plugin.refreshSnippetTypes(),this.display()})}),this.plugin.settings.scanSnippets){let t=this.plugin.snippetTypes.length,e=this.plugin.snippetTypes.filter(o=>o.color.startsWith("var(")).length,s=this.plugin.snippetTypes.filter(o=>o.iconDefault).length,n=this.plugin.snippetTypes.filter(o=>o.color.startsWith("var(")||o.iconDefault).length,a=t>0?`Detected types (${t})`:"No custom types detected",p=t>0?"Custom callout types found in your enabled CSS snippets.":"No callout definitions were found in your enabled CSS snippet files.",u=new d.Setting(l).setName(a).setDesc(p).addExtraButton(o=>{o.setIcon("refresh-cw").setTooltip("Refresh snippets").onClick(async()=>{await this.plugin.refreshSnippetTypes(),this.display()})}).addExtraButton(o=>{o.setIcon("folder-open").setTooltip("Open snippets folder").onClick(()=>{let i=`${this.app.vault.configDir}/snippets`;this.app.openWithDefaultApp(i)})});if(n>0){let o=[];e>0&&o.push(`${e} missing color`),s>0&&o.push(`${s} missing icon`);let i=u.nameEl.createSpan({cls:"detected-snippet-header-warning"});(0,d.setIcon)(i,"alert-triangle"),i.setAttribute("aria-label",o.join(", "))}if(t>0){let o=l.createEl("details",{cls:"detected-snippet-types"});o.createEl("summary",{text:"Show callouts",cls:"detected-snippet-types-summary"});let i=o.createDiv({cls:"detected-snippet-type-row detected-snippet-type-header"});i.createSpan({text:"Icon",cls:"detected-snippet-col-icon"}),i.createSpan({text:"Callout",cls:"detected-snippet-col-callout"}),i.createSpan({text:"Icon Name",cls:"detected-snippet-col-iconname"}),i.createSpan({text:"Color",cls:"detected-snippet-col-color"}),i.createSpan({text:"",cls:"detected-snippet-col-status"});for(let c of this.plugin.snippetTypes){let h=o.createDiv({cls:"detected-snippet-type-row"}),g=h.createDiv({cls:"detected-snippet-col-icon detected-snippet-type-icon"});(0,d.setIcon)(g,c.icon),g.style.setProperty("--callout-color",c.color),h.createSpan({text:c.label,cls:"detected-snippet-col-callout"});let y=c.iconDefault?"\u2014":c.icon;h.createSpan({text:y,cls:"detected-snippet-col-iconname detected-snippet-type-meta"});let b=c.color.startsWith("var(")?"\u2014":`rgb(${c.color})`;h.createSpan({text:b,cls:"detected-snippet-col-color detected-snippet-type-meta"});let S=h.createDiv({cls:"detected-snippet-col-status"}),D=c.color.startsWith("var("),L=c.iconDefault===!0;if(D||L){let I=[];D&&I.push("no --callout-color"),L&&I.push("no --callout-icon");let O=S.createDiv({cls:"detected-snippet-type-warning"});(0,d.setIcon)(O,"alert-triangle"),O.setAttribute("aria-label",`Missing: ${I.join(", ")} \u2014 using defaults`)}}}if(this.plugin.snippetWarnings.length>0){let o=l.createDiv({cls:"detected-snippet-warnings"}),i=o.createDiv({cls:"detected-snippet-warnings-header"}),c=i.createDiv({cls:"detected-snippet-warnings-icon"});(0,d.setIcon)(c,"alert-triangle"),i.createSpan({text:"Some snippet files contain malformed callout definitions"});let h=o.createEl("ul");for(let g of this.plugin.snippetWarnings)h.createEl("li",{text:`${g.file} \u2014 ${g.malformedCount} malformed ${g.malformedCount===1?"entry":"entries"}`})}}}};
